<head>
	<meta charset="utf-8">
	<title>Lab Dinámica</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
		integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
		crossorigin="anonymous"></script>
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/tabler-icons/1.35.0/iconfont/tabler-icons.min.css"
		integrity="sha512-tpsEzNMLQS7w9imFSjbEOHdZav3/aObSESAL1y5jyJDoICFF2YwEdAHOPdOr1t+h8hTzar0flphxR76pd0V1zQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
	<script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
	<style>
		body {
			margin: 0;
		}
		canvas {
			width: 100%;
			height: 100%
		}
		#ventana {
			background-color: #ffffff;
			width: 400px;
			height: 200px;
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
</head>
<body>

		<div class="position-fixed w-100 p-3 border-bottom" style="z-index: 100000;background-color: #ffffff;">
			<div class="row">
				<div class="col-md-3">
					<a href="/" class="d-flex align-items-center text-dark text-decoration-none">
						<img src="logo.png" style="height: 30px;">
						<span class="fs-8">LABORATORIOS VIRTUALES</span>
					</a>
				</div>
				<div class="col-md-9" style="text-align: right;">
					<a class="btn btn-sm btn-outline-secondary" href="index.html">Dinámica Experimental</a>
	
				</div>
			<!--	<div class="col-md-9" style="text-align: right;">
					
					<a class="btn btn-sm btn-outline-secondary" href="index copy.html">aaTorsión</a>
					<a class="btn btn-sm btn-outline-secondary" href="https://reidermunoz.github.io/lab-tension.github.io/">SISTorsión</a>
					<a class="btn btn-sm btn-outline-secondary" href="#">Torsión</a>
					<a class="btn btn-sm btn-outline-secondary" href="#">Torsión</a>
				</div>-->
			</div>
		</div>
	
		<div class="position-fixed" style="width: 400px;background-color: #ffffff;padding: 90px 5px; height: 100%;">
	
	
			<div class="card mb-2" style="width: 100%;">
				<div class="card-body">
					<canvas id="myChart" style="width: 200px;height: 100px;"></canvas>
				</div>
			</div>
	
			<div class="card" style="width: 100%;">
				<div class="card-body">
					<div style="text-align: center;">
						<button type="button" onclick="zoom()" class="btn btn-primary">Zoom</button>
						<button type="button" onclick="Po_box(),Masa_box(),Wn_box(),c_box(),Dt_box(),k_box(),contador(),contador2(),contador3(),ConsMDI()" class="btn btn-secondary">Iniciar</button>
						<button type="button" download="Datos.xlsx" class="btn btn-success">Datos</button>
					</div>
				</div>
			</div>
			<div class="card mt-2" style="width: 100%;">
				<div class="card-body">
					<form class="row g-2">
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size:14px">Amplitud Po<i
									data-tippy-content="Punto donde la gráfica deja de comportarse de forma lineal"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="Po_box"
								id="Po_box" placeholder="">
						</div>
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size: 14px">Frecuencia angular Wn <i
									data-tippy-content="El módulo de elasticidad es la pendiente del diagrama esfuerzo-deformación unitaria en la región linealmente elástica; esfuerzo/deformación"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="Wn_box"
								id="Wn_box" placeholder="">
						</div>
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size: 14px">Masa <i
									data-tippy-content="Punto máximo de la grafica"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="Masa_box"
								id="Masa_box" placeholder="">
						</div>
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size: 14px">Amortiguamiento c <i
									data-tippy-content="Punto final de la gráfica, donde se rompe la probeta"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="c_box" id="c_box"
								placeholder="">
						</div>
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size: 14px">Rigidez K <i
									data-tippy-content="Es igual al área debajo de la curva esfuerzo-deformación hasta el límite de proporcionalidad. La resiliencia representa la capacidad de un material para absorber y liberar energía dentro del intervalo elástico"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="k_box" id="k_box"
								placeholder="">
						</div>
						<div class="col-auto" style="width:180px">
							<label class="form-label" style="font-size: 14px">Paso Δt <i
									data-tippy-content="Es igual al área debajo de toda la curva esfuerzo-deformación. La tenacidad, se refiere a la capacidad de un material para absorber energía sin fracturarse"
									class="ti ti-question-mark text-primary"></i></label>
							<input type="text" class="form-control form-control-sm" name="Dt_box" id="Dt_box"
								placeholder="">
						</div>
					</form>
				</div>
			</div>
		</div>
	<script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/three.min.js"></script>	
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/controls/OrbitControls.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/loaders/GLTFLoader.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="tension_barra2.js"></script>
	<script>

		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
		var Mesa1; var esfera2; var Cilindros; var lab; var Mesa2;
		const renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		clock = new THREE.Clock();
		scene = new THREE.Scene();
		scene.background = new THREE.Color(0xa0a0a0);
		scene.fog = new THREE.Fog(0xa0a0a0, 10, 50);
		const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
		hemiLight.position.set(0, 20, 0);
		scene.add(hemiLight);
		const dirLight = new THREE.DirectionalLight(0xffffff);
		dirLight.position.set(- 3, 10, - 10);
		dirLight.castShadow = true;
		dirLight.shadow.camera.top = 2;
		dirLight.shadow.camera.bottom = - 2;
		dirLight.shadow.camera.left = - 2;
		dirLight.shadow.camera.right = 2;
		dirLight.shadow.camera.near = 0.1;
		dirLight.shadow.camera.far = 40;
		scene.add(dirLight);
		const controls = new THREE.OrbitControls(camera, renderer.domElement);
		camera.position.set(10, 4.5, 15); // posicion de la camara (0, 5, 5)
		controls.update();
		renderer.render(scene, camera);
		//Varibles necesaria para generar el desplazamiento en la base
		var Vtiempo=[]; var Vtiempo2=[];
        var Seno=[];
        var Po=0;
        var Wn=0;
        var Segundos=60;
		var m=0;
		var p=[]; var p1=[]; 
		var u=[]; var up=[]; var upp=[]; var P=[]; var u2=[]; var up2=[]; var upp2=[];
		var dt=0;
		u2[0]=0;
		up2[0]=0;
		upp2[0]=0;
		var u0=0; var up0=0; var p0=0; //Condiciones inciales
		var k=0; var c=0;// Masa, Rigidez, Amortiguamiento
		var a1=1; var a2=1; var a3=1; var kj=1; //Constantes pa el método númerico
		// // Variables necesarias para resolver el método númerico
		// var u0=0; var up0=0; var p0=0; //Condiciones inciales
		// var k=10; var c=0.1592;// Masa, Rigidez, Amortiguamiento
		// var Vtiempo=[]; var Vtiempo2=[];
        // var Seno=[];
        // var Po=0.8;
        // var Wn=4*Math.PI/3;
        // var Segundos=60;
		// var m=0.2533;
		// var p=[]; var p1=[]; 
		// var u=[]; var up=[]; var upp=[]; var P=[]; var u2=[]; var up2=[]; var upp2=[];
		// var dt=0.02;
		// u2[0]=0;
		// up2[0]=0;
		// upp2[0]=0;
		// // Variables necesarias para resolver el método númerico
		// var u0=0; var up0=0; var p0=0; //Condiciones inciales
		// var k=10; var c=0.1592;// Masa, Rigidez, Amortiguamiento
		//Obtención de Variables desde las cajas
		function Masa_box(){
	     m = parseFloat(document.getElementById('Masa_box').value);
         }
		function Po_box(){
	     Po = parseFloat(document.getElementById('Po_box').value);
         } 
		function Wn_box(){
	     Wn = parseFloat(document.getElementById('Wn_box').value);
         }
		function c_box(){
	     c = parseFloat(document.getElementById('c_box').value);
         }
		function k_box(){
	     k = parseFloat(document.getElementById('k_box').value);
          }
		function Dt_box(){
	     dt = parseFloat(document.getElementById('Dt_box').value);
		 iniciar2=1;
          } 
		function ConsMDI(){
		 a1=(4*m/(dt*dt))+(2*c/(dt));
		 a2=(4/(dt))*m+c;
         a3=m;
		 kj=k+a1;
		}
        function contador (){
     	 var contador1=0;
		 var t=0;
		 p1[0]=0;
         function Senoiterativo (){
	     Vtiempo[contador1]=contador1;
	      Seno[contador1]=Po*Math.sin(Wn*t); //Desplazamiento en la base
		  p[contador1]=(Wn*Wn)*m*Seno[contador1]; //Aceleración en el grado de libertad debido al desplazamiento
		  p1[contador1]=(Wn*Wn)*m*Po*Math.sin(Wn*(t+dt)); //P+1
		//   p1[contador1]=Po*Math.sin(Wn*(t+dt)); Para probar el método
		//   p[contador1]=Seno[contador1]; // Para probar el método
		  P[contador1]=0;
		//   Mesa1.position.z=Seno[contador1] //Posición z de la mesa
		  Mesa1.position.x=Seno[contador1]+5 //Posición x de la mesa
		  Barra.position.x=Seno[contador1]+5 //Posición barra en x
		//   console.log(u[contador1]);
	       contador1++;
		   Vtiempo2[contador1]=t;
		   t=t+dt;
           //console.log(Vtiempo);
		   //console.log(Mesa1.position.y);
		   renderer.render(scene, camera);
         if (contador1==(Segundos*60+1)){
             clearInterval(tiempo);
               }
                  }
          var tiempo=setInterval(Senoiterativo,50)
                }
        //   contador()
		 // Constantes necesarias para el método númerico
		 // Llenar los vectores con zeros
		 function contador2 (){
     	       var contador1=0;
			   var contadorr=1;
		       var t=0;
                 function Newmark (){
				   p[contadorr];
		           P[contador1]=p1[contador1]+a1*u2[contador1]+a2*up2[contador1]+a3*upp2[contador1];
				   u2[contador1+1]=[P[contador1]]/kj;
				   up2[contador1+1]=[2/dt]*[u2[contador1+1]-u2[contador1]]-up2[contador1];
				   upp2[contador1+1]=(4/((dt*dt)))*[u2[contador1+1]-u2[contador1]]-[4/dt]*up2[contador1]-upp2[contador1];
				   esfera2.position.x=u2[contador1]+Seno[contador1]+5;
				//    esfera1.position.z=u2[contador1]+Seno[contador1];
				   chart.data.datasets[0].data.push({y: u2[contador1], x: t })
			       chart.update();
				   contador1++;
		            t=t+dt;
					
                    if (contador1==(Segundos*60+1)){
                    clearInterval(tiempo);
                        }
                      }
                       var tiempo=setInterval(Newmark,50)
                                  }
        //  contador2()
            {
			const color = 0xFFFFFF; //Ligth color
            const intensity = 0.04;  // Ligth intensity
            const light = new THREE.DirectionalLight(color, intensity); //Ligth Set
            light.position.set(-1, 2, 4); //Ligth position set
            scene.add(light); //Ligth Add
             }
                 // Cargar Cubo
				// const color = 0xFFFFFF;
				let geometry = new THREE.BoxGeometry(0.3,2,0.3,5,5,5); //Geomtria del cubo, en el espacio
					// const loader8 = new THREE.TextureLoader(); //Texture loader, cargador de textura sonaba paila
					// const texture = loader8.load('https://threejs.org/manual/examples/resources/images/star.png');
					// const material = new THREE.MeshPhongMaterial({color, map: texture}); //Crea el material, apartir del color y la textura
					const material = new THREE.MeshBasicMaterial({
						color: 0xFFFFF, //Color del cubo
						wireframe: true, //Mostrar los segmentos con hilos
						
					});
					const cube = new THREE.Mesh(geometry, material); //Crea el cubo apartir de la geomtría y la textura
					cube.rotation.y = - Math.PI / 2;
					scene.add(cube);
					geometry.attributes.position.count 
		// function contador3 (){
     	//    var contador1=0;
		//    var div=1;
		//    var t=0;
		//    let geometry = new THREE.BoxGeometry(5,20,5,5,5,5);
		//    console.log(geometry)
		// 			const material = new THREE.MeshBasicMaterial({
		// 				color: 0x88FF88, //Color del cubo
		// 				wireframe: true, //Mostrar los segmentos con hil
		// 			});
		// 			const cube = new THREE.Mesh(geometry, material);
		// 			cube.rotation.y = - Math.PI / 2;
		// 			scene.add(cube);
        //          function BarDeformation (){
					
		// 			console.log('HolaMundo')
		// 			renderer.render(scene, camera);
        //             if (contador1==(Segundos*40+1)){
        //             clearInterval(tiempo);
        //                 }
        //               }
        //                var tiempo=setInterval(BarDeformation,500)
        //                           }
        //  contador3()
		 function contador3 (){
     	       var contador1=0;
			   var div=1;
		       var t=0;
			   const now = Date.now() / 300;
                 function BarDeformation (){
					const x = geometry.attributes.position.getX(contador1)
					contador1++;
					div=div+0.1
                    const y = geometry.attributes.position.getY(contador1)
                    const xsin = -Math.pow(contador1,2)
                    const ycos = 0.008*contador1*Math.cos(contador1)
                    cube.geometry.attributes.position.setZ(contador1, Po/(div))
					geometry.attributes.position.needsUpdate = true;
					cube.geometry.attributes.position.setZ(contador1, -Po/(div))
					geometry.attributes.position.needsUpdate = true;
					renderer.render(scene, camera);
                    if (contador1==(Segundos*40+1)){
                    clearInterval(tiempo);
                        }
                      }
                       var tiempo=setInterval(BarDeformation,500)
                                  }
        //  contador3()	
		 tippy('[data-tippy-content]');
		 console.log(Po)
var ctx = document.getElementById("myChart").getContext("2d"); //Grafica
const contador_barra1 = [];
const chart = new Chart(ctx, {
	type: 'line',
	data: {
		datasets: [{
			borderColor: 'rgb(222,42,22)',
			borderWidth: 2,
			pointRadius: 0,
		}]
	},
	options: {
		animation: {
			duration: 0
		},
		interaction: {
			intersect: false
		},
		plugins: {
			legend: false
		},
		scales: {
			x: {
				type: 'linear',
				max: 10,
				min: 0
			},
			y: {
				type: 'linear',
				max: Po+Po/(10*Po),
				min: -Po-Po/(10*Po)
			}
		}
	}
});
const loader1 = new THREE.GLTFLoader();
// Load a glTF resource, Lab loading
loader1.load(
	'lab.gltf',//'scene.gltf'
	function ( gltf ) {
		lab = gltf.scene; 
		scene.add( lab );
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		lab.position.z+=0
		lab.position.x+=5
		lab.position.y+=-1.2
		renderer.render(scene,camera);
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader2 = new THREE.GLTFLoader();
// Load a glTF resource, Mesa1 Loading
loader2.load(
	'Mesa1.gltf',//'scene.gltf'
	function ( gltf ) {
		Mesa1 = gltf.scene; 
		scene.add( Mesa1 );
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		Mesa1.position.z+=0
		Mesa1.position.x+=5
		Mesa1.position.y+=-1
		renderer.render(scene,camera);
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader3 = new THREE.GLTFLoader();
// Load a glTF resource, Esfera1 Loading
loader3.load(
	'esfera2.gltf',//'scene.gltf'
	function ( gltf ) {
		esfera2 = gltf.scene; 
		scene.add( esfera2 );
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		esfera2.position.z+=0
		esfera2.position.x+=5
		esfera2.position.y+=-1
		renderer.render(scene,camera);
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader4 = new THREE.GLTFLoader();
// Load a glTF resource, Mesa1 Loading
loader4.load(
	'Cilindros.gltf',//'scene.gltf'
	function ( gltf ) {
		Cilindros = gltf.scene; 
		scene.add(Cilindros);
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		Cilindros.position.z+=0
		Cilindros.position.x+=5
		Cilindros.position.y+=-1
		renderer.render(scene,camera);
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader5 = new THREE.GLTFLoader();
// Load a glTF resource, Mesa1 Loading
loader5.load(
	'Mesa2.gltf',//'scene.gltf'
	function ( gltf ) {
		Mesa2 = gltf.scene; 
		scene.add(Mesa2);
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		Mesa2.position.z+=0
		Mesa2.position.x+=5
		Mesa2.position.y+=-1.5
		renderer.render(scene,camera);

	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader6 = new THREE.GLTFLoader();
// Load a glTF resource, Barra Loading
loader6.load(
	'Barra.gltf',//'scene.gltf'
	function ( gltf ) {
		Barra = gltf.scene; 
		scene.add(Barra);
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		Barra.position.z+=0
		Barra.position.x+=5
		Barra.position.y+=0.5
		renderer.render(scene,camera);

	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
	</script>
</body>
</html>