<head>
	<meta charset="utf-8">
	<title>Mesa movida por un seno</title>
	<style>
		body {
			margin: 0;
		}
		canvas {
			width: 100%;
			height: 100%
		}
	</style>
</head>
<body>
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/controls/OrbitControls.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/three@0.136.0/examples/js/loaders/GLTFLoader.js"></script>
	<script>
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
		var Mesa1; var esfera1;
		const renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		clock = new THREE.Clock();
		scene = new THREE.Scene();
		scene.background = new THREE.Color(0xa0a0a0);
		scene.fog = new THREE.Fog(0xa0a0a0, 10, 50);
		const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
		hemiLight.position.set(0, 20, 0);
		scene.add(hemiLight);
		const dirLight = new THREE.DirectionalLight(0xffffff);
		dirLight.position.set(- 3, 10, - 10);
		dirLight.castShadow = true;
		dirLight.shadow.camera.top = 2;
		dirLight.shadow.camera.bottom = - 2;
		dirLight.shadow.camera.left = - 2;
		dirLight.shadow.camera.right = 2;
		dirLight.shadow.camera.near = 0.1;
		dirLight.shadow.camera.far = 40;
		scene.add(dirLight);
		const controls = new THREE.OrbitControls(camera, renderer.domElement);
		camera.position.set(5, 2, 0); // posicion de la camara (0, 5, 5)
		controls.update();
		renderer.render(scene, camera);
		//Varibles necesaria para generar el desplazamiento en la base
		var Vtiempo=[]; var Vtiempo2=[];
        var Seno=[];
        var Po=10;
        var Wn=5*Math.PI/3;
        var Segundos=60;
		var m=4*5;
		var p=[]; var p1=[]; 
		var u=[]; var up=[]; var upp=[]; var P=[]; var u2=[]; var up2=[]; var upp2=[];
		u2[0]=0;
		up2[0]=0;
		upp2[0]=0;
		//Función para mover el seno y la animación
        function contador (){
     	 var contador1=0;
		 var t=0;
		 p1[0]=0;
         function Senoiterativo (){
	     Vtiempo[contador1]=contador1;
	      Seno[contador1]=Po*Math.sin(Wn*t); //Desplazamiento en la base
		  //p[contador1]=(Wn^2)*m*Seno[contador1]; //Aceleración en el grado de libertad debido al desplazamiento
		  p1[contador1]=-(Wn^2)*m*Po*Math.sin(Wn*(t+0.02));
		  p[contador1]=Seno[contador1];
		  P[contador1]=0;
		//   Mesa1.position.z=Seno[contador1] //Posición z de la mesa
		  Mesa1.position.x=-Seno[contador1] //Posición x de la mesa
		//   console.log(u[contador1]);
	       contador1++;
		   Vtiempo2[contador1]=t;
		   t=t+0.02;
           //console.log(Vtiempo);
		   //console.log(Mesa1.position.y);
		   renderer.render(scene, camera);
         if (contador1==(Segundos*60+1)){
             clearInterval(tiempo);
               }
                  }
          var tiempo=setInterval(Senoiterativo,100)
                }
          contador()
		// Variables necesarias para resolver el método númerico
		var u0=0; var up0=0; var p0=0; //Condiciones inciales
		var k=10; var c=0.1592; var dt=0.02; // Masa, Rigidez, Amortiguamiento
		 // Constantes necesarias para el método númerico
		var m=0.2533; 
		var a1=0; var a2=0; var a3=0; var kj=0;
		 a1=(4*m/(dt*dt))+(2*c/(dt));
		 a2=(4/(dt))*m+c;
         a3=m;
		 kj=k+a1;
		 console.log(p[0])
		 // Llenar los vectores con zeros
		 function contador2 (){
     	       var contador1=0;
			   var contadorr=1;
		       var t=0;
                 function Newmark (){
				   p[contadorr];
		           P[contador1]=p1[contador1]+a1*u2[contador1]+a2*up2[contador1]+a3*upp2[contador1];
				   u2[contador1+1]=[P[contador1]]/kj;
				   up2[contador1+1]=[2/dt]*[u2[contador1+1]-u2[contador1]]-up2[contador1];
				   upp2[contador1+1]=(4/((dt*dt)))*[u2[contador1+1]-u2[contador1]]-[4/dt]*up2[contador1]-upp2[contador1];
				   esfera1.position.x=u2[contador1]+Seno[contador1];
				//    esfera1.position.z=u2[contador1]+Seno[contador1];
				   contador1++;
		            t=t+0.02;
                    if (contador1==(Segundos*60+1)){
                    clearInterval(tiempo);
                        }
                      }
                       var tiempo=setInterval(Newmark,100)
                                  }
         contador2()

// Instantiate a loader
const loader2 = new THREE.GLTFLoader();
// Load a glTF resource
loader2.load(
	'Mesa1.gltf',//'scene.gltf'
	function ( gltf ) {
		Mesa1 = gltf.scene; 
		scene.add( Mesa1 );
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		Mesa1.position.z+=0
		Mesa1.position.x+=-0
		Mesa1.position.y+=0
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
// Instantiate a loader
const loader3 = new THREE.GLTFLoader();
// Load a glTF resource
loader3.load(
	'esfera1.gltf',//'scene.gltf'
	function ( gltf ) {
		esfera1 = gltf.scene; 
		scene.add( esfera1 );
		gltf.animations; // Array<THREE.AnimationClip>
		gltf.scene; // THREE.Group
		gltf.scenes; // Array<THREE.Group>
		gltf.cameras; // Array<THREE.Camera>
		gltf.asset; // Object
		console.log('completado!.....')
		esfera1.position.z+=2
		esfera1.position.x+=-2
		esfera1.position.y+=2
	},
	// called while loading is progressing
	function ( xhr ) {
		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
	},
	// called when loading has errors
	function ( error ) {
		console.log( 'An error happened' );
	}
); 
	</script>
	<!-- <script>
var Vtiempo=[];
var Seno=[];
var Po=5;
var Wn=2*Math.PI;
var Segundos=20;
function contador (){
	var contador1=0;
 function Senoiterativo (){
	Vtiempo[contador1]=contador1;
	Seno[contador1]=Po*Math.sin(Wn*contador1);
	contador1++;
console.log(Vtiempo);
if (contador1==Segundos+1){
clearInterval(tiempo);
}
}
var tiempo=setInterval(Senoiterativo,1000)
}
contador()
	</script> -->
</body>
</html>